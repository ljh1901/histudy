<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.histudy.admin">
    <select id="selectAllCafes" resultType="com.histudy.admin.model.StudyCafeDTO">
        select * from studycafe order by studycafe_idx asc
    </select>

    <select id="selectSalesList" parameterType="map" resultType="map">
        select
        <choose>
            <when test="type == 'month'"> to_char(sales_date, 'yyyy-mm') as sales_date,
                sum(total_amount) as total_amount
            </when>
            <when test="type == 'total'"> '누적 매출' as sales_date,
                sum(total_amount) as total_amount
            </when>
            <otherwise>
                to_char(sales_date, 'yyyy-mm-dd') as sales_date,
                total_amount as total_amount
            </otherwise>
        </choose>
        from sales_report
        where studycafe_idx = #{studycafe_idx}
        <if test="startDate != null and startDate != ''">
            and sales_date &gt;= to_date(#{startDate}, 'yyyy-mm-dd')
        </if>
        <if test="endDate != null and endDate != ''">
            and sales_date &lt;= to_date(#{endDate}, 'yyyy-mm-dd')
        </if>
        <choose>
            <when test="type == 'month'"> 
                group by to_char(sales_date, 'yyyy-mm') 
            </when>
            <when test="type == 'total'"> 
                group by '누적 매출' 
            </when>
        </choose>
        order by sales_date asc
    </select>
    <select id="getFaqCategoryList" resultType="com.histudy.admin.model.MenuCategoryDTO">
        select * from menu_category order by menu_category_idx asc
    </select>

    <select id="getFaqList" parameterType="map" resultType="com.histudy.admin.model.FaqDTO">
    select 
        f.faq_idx, 
        f.menu_category_idx, 
        f.faq_title, 
        f.faq_content,
        c.menu_category_name  from faq f 
    join menu_category c on f.menu_category_idx = c.menu_category_idx
    <where>
        <if test="menu_category_idx != null and menu_category_idx != 0">
            and f.menu_category_idx = #{menu_category_idx}
        </if>
    </where>
    order by f.faq_idx desc
</select>
<select id="getFaqOne" parameterType="int" resultType="com.histudy.admin.model.FaqDTO">
    SELECT 
        faq_idx, 
        menu_category_idx, 
        faq_title, 
        faq_content 
    FROM faq 
    WHERE faq_idx = #{faq_idx}
</select>

<update id="updateFaq" parameterType="com.histudy.admin.model.FaqDTO">
    UPDATE faq 
    SET 
        menu_category_idx = #{menu_category_idx},
        faq_title = #{faq_title},
        faq_content = #{faq_content}
    WHERE 
        faq_idx = #{faq_idx}
</update>

<delete id="deleteLayoutByCafeIdx" parameterType="int">
    DELETE FROM studycafe_layout 
    WHERE studycafe_idx = #{studycafe_idx}
</delete>

<insert id="insertLayout" parameterType="map">
    INSERT INTO studycafe_layout (
        layout_idx, 
        studycafe_idx, 
        type, 
        label, 
        x, 
        y, 
        width, 
        height
    ) VALUES (
        seq_layout_idx.NEXTVAL,
        #{studycafe_idx},
        #{type},
        #{label},
        #{x},
        #{y},
        #{width},
        #{height}
    )
</insert>

<select id="selectLayoutList" parameterType="int" resultType="map">
    SELECT 
        type, 
        label, 
        x, 
        y, 
        width, 
        height 
    FROM studycafe_layout 
    WHERE studycafe_idx = #{studycafe_idx}
    ORDER BY layout_idx ASC
</select>
</mapper>