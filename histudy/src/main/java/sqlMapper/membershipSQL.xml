<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.histudy.membership.model.MembershipDAO">
    <insert id="insertPrimium" parameterType="com.histudy.membership.model.MembershipPaymentDTO">
        INSERT INTO MEMBERSHIP_PAYMENT VALUES (
            MEMBERSHIP_PAYMENT_IDX.NEXTVAL,  
            #{payNum},                
            #{payment_method},        
            #{payment_status},        
            #{payment_amount},        
            SYSDATE,    
            #{tax_free},
            ADD_MONTHS(SYSDATE, 1),            
            #{user_idx},              
            (SELECT membership_idx FROM membership WHERE membership_name = '프리미엄')
        )
    </insert>
    <select id="membershipGrade" parameterType="int" resultType="String">
	    SELECT membership_name 
	    FROM (
	        SELECT m.membership_name
	        FROM membership_payment mp
	        JOIN membership m ON mp.membership_idx = m.membership_idx
	        WHERE mp.user_idx = #{user_idx}
	        ORDER BY mp.end_date DESC 
	    )
	    WHERE ROWNUM = 1 
	</select>
	<insert id="insertBasic" parameterType="int">
    INSERT INTO MEMBERSHIP_PAYMENT VALUES (
        MEMBERSHIP_PAYMENT_IDX.NEXTVAL,
        '0',      
        '0',       
        '가입',         
        0,            
        SYSDATE, 
        0,
        SYSDATE,        
        #{user_idx},       
        (SELECT membership_idx FROM membership WHERE membership_name = '일반')
    )
	</insert>
	
</mapper>