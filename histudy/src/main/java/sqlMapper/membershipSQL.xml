<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.histudy.membership.model.MembershipDAO">
    <insert id="insertPayment" parameterType="com.histudy.membership.model.MembershipPaymentDTO">
        INSERT INTO MEMBERSHIP_PAYMENT VALUES (
            MEMBERSHIP_PAYMENT_IDX.NEXTVAL,  
            #{payId},
            #{payNum},                
            #{payment_method},        
            #{payment_status},        
            #{payment_amount},        
            SYSDATE,                  
            #{user_idx},              
            #{membership_idx}         
        )
    </insert>
    <select id="membershipGrade" parameterType="int" resultType="String">
	    SELECT membership_name 
	    FROM (
	        SELECT m.membership_name
	        FROM membership_payment mp
	        JOIN membership m ON mp.membership_idx = m.membership_idx
	        WHERE mp.user_idx = #{user_idx}
	        ORDER BY mp.payment_idx DESC  )
	    WHERE ROWNUM = 1 
	</select>
</mapper>